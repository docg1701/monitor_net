# Story 1.2.5: Implement Network Monitoring Logic

## Status
Approved

## Story
**As a** User,
**I want** the application to accurately measure and display network latency,
**so that** I can monitor my connection stability without seeing "zero" values due to browser restrictions.

## Acceptance Criteria
1.  The Rust backend (`src-tauri/src/lib.rs` or new module) implements a Tauri command (e.g., `ping`) that performs a network request (HEAD/GET or ICMP) to a *frontend-configured target (`environment.pingUrl`)*. Arbitrary external URLs should not be accessible via this command.
2.  The Angular service (`MonitorService`) is updated to invoke this Tauri command instead of using `HttpClient`.
3.  CORS issues are resolved by bypassing the browser's network stack via the Rust backend.
4.  The chart correctly displays real latency values returned by the backend.
5.  The application handles errors (e.g., timeout, offline) gracefully and returns appropriate status to the frontend.

## Tasks / Subtasks
- [ ] Add Rust dependencies. (AC: 1)
    - [ ] Update `netmonitor/src-tauri/Cargo.toml` to include `reqwest` (blocking or async) or `surge-ping` (if ICMP is preferred/possible without root, stick to HTTP for simplicity first). *Decision: Use `reqwest` for HTTP ping as it's simpler and doesn't require raw socket permissions usually.*
- [ ] Implement `ping` command in Rust. (AC: 1)
    - [ ] Create a command function `fn ping(url: &str) -> Result<PingResult, String>`.
    - [ ] Measure time taken to request the URL.
    - [ ] Register the command in `lib.rs`.
- [ ] Update `MonitorService` in Angular. (AC: 2, 3)
    - [ ] Import `invoke` from `@tauri-apps/api/core`.
    - [ ] Replace `HttpClient.head` logic with `invoke('ping', { url: ... })`.
    - [ ] Update data handling to map the Rust response to the frontend model.
- [ ] Verify Functionality. (AC: 4, 5)
    - [ ] Run `tauri dev`.
    - [ ] Verify chart updates with non-zero values.
    - [ ] Disconnect network and verify error handling.

## Dev Notes
**Technical Approach**:
- **Backend**: Use `reqwest` to make a `HEAD` request to the target URL. Measure the duration using `std::time::Instant`.
- **Frontend**: The current `MonitorService` uses `HttpClient`. We need to swap this out.
- **Security**: The `ping` command allows arbitrary URL requests. For this story, we can accept this, or restrict it to the configured URL.
- **Dependencies**:
    - Rust: `reqwest = { version = "0.12", features = ["blocking", "json"] }` (or async with tokio, Tauri v2 is async by default).

## Dev Agent Record

### File List

### Completion Notes

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 05/12/2025 | 1.0 | Initial draft | James (Dev) |