# Story 1.4: Android & Desktop Integration Verification

## Status
Done

## Story
**As a** User,
**I want** to run the application on my Android device and Linux/Windows desktop,
**so that** I can use the tool in my preferred environment without configuration issues.

## Acceptance Criteria
1.  Android build artifact is generated successfully (`ionic build` + `npx cap sync android`) and configuration files (`AndroidManifest.xml`) are present and correct. (Runtime verification delegated to manual testing).
2.  Electron build scripts are configured, main process entry point exists, and dependencies are installed. (Runtime verification dependent on environment capabilities).
3.  Network requests work successfully on both platforms (no CORS/Permission blocks for standard targets).
4.  App layout handles platform-specific safe areas (status bars, window chrome) correctly.

## Dev Notes
### Technology Stack
*   **Mobile Runtime**: Capacitor v5+ (as per `docs/rescrita-tecnica-angular.md`). [Source: `docs/rescrita-tecnica-angular.md#22-runtime-&-build-system`]
*   **Desktop Runtime**: Electron (LTS). [Source: `docs/rescrita-tecnica-angular.md#22-runtime-&-build-system`]
*   **Build System**: Ionic CLI for Android, Electron Builder/Runner for Desktop. [Source: `docs/rescrita-tecnica-angular.md#22-runtime-&-build-system`]

### Project Structure & File Locations
*   **Android Project**: `android/` (to be generated). [Source: `docs/rescrita-tecnica-angular.md#22-runtime-&-build-system`]
*   **Electron Main**: `electron/main.js`. [Source: `docs/rescrita-tecnica-angular.md#31-estrutura-de-pastas-padrão-angular-cli`]
*   **Web Output**: `www/`. [Source: `netmonitor/angular.json` output path]

### Technical Constraints
*   **Network Requests**: Must use Angular's `HttpClient` (Web API) to ensure compatibility with Capacitor's network handling on Android. [Source: `docs/rescrita-tecnica-angular.md#41-o-problema-do-ping-solução-cross-platform`]
*   **Permissions**: Android requires `INTERNET` permission (usually default in Capacitor, but verify `AndroidManifest.xml`).
*   **Safe Areas**: Ensure `ion-content` and global styles handle `ion-safe-area-top/bottom` variables correctly. [Source: `docs/rescrita-tecnica-angular.md#5-instruções-de-interface-ui/ux`]

### Previous Story Insights
*   Story 1.3 verified `MonitorService` and `home.page.ts` logic via unit tests.
*   Story 1.3 converted modules to Standalone Components. Ensure this doesn't affect Electron/Capacitor bootstrapping (it shouldn't, as it compiles to JS).

### Testing Requirements
*   **Android**: Since you are in a CLI environment without an emulator, you must Generate the Android project (`npx cap add android`) and Sync it (`npx cap sync`). You cannot *run* it, but you should verify the *build* process (`npx cap open android` is not possible, so rely on `npx cap sync` success and file generation checks).
*   **Electron**: Run `npm run electron:start` (or similar) to verify the app launches. If in a headless environment, this might fail to open a window. You may need to check if the process starts or rely on `electron-builder` dry-run if applicable. **However**, the AC requires it to function. Use your judgment to verify configurations if runtime is impossible.
*   **Safe Areas**: Review `src/global.scss` or `src/theme/variables.scss` to ensure Ionic safe area variables are present.

## Tasks / Subtasks
*   [x] Generate Android Platform
    *   [x] Run `ionic build` (or `ng build`) to populate `www/`.
    *   [x] Run `npx cap add android`.
    *   [x] Verify `android/` directory creation.
*   [x] Configure & Verify Electron
    *   [x] Ensure `package.json` has `electron:start` script: `"electron:start": "ng build && electron ."`.
    *   [x] Verify `electron` and `electron-builder` are in `devDependencies`.
    *   [x] Verify `electron/main.js` loads `../www/index.html`.
    *   [x] Attempt to run `npm run electron:start` (if environment permits) or verify `electron` binary is executable.
*   [x] Verify Network Permissions (Android)
    *   [x] Check `android/app/src/main/AndroidManifest.xml` for `<uses-permission android:name="android.permission.INTERNET" />`.
    *   [x] Check for `android:usesCleartextTraffic="true"` if testing with HTTP (non-SSL) targets is required (optional, but good for stability).
*   [x] Safe Area Handling
    *   [x] Verify `index.html` contains `<meta name="viewport" content="viewport-fit=cover, ...">`.
    *   [x] Verify `src/theme/variables.scss` or global styles do not override safe area defaults negatively.
*   [x] Project Alignment Check
    *   [x] Ensure `android` and `electron` folders are at the root level of `netmonitor/` (not inside `src`).
*   [x] Final Sync & Build Check
    *   [x] Run `npx cap sync`.
    *   [x] Run `npx cap copy`.

## Dev Agent Record

### File List
*   netmonitor/android/
*   netmonitor/package.json
*   netmonitor/package-lock.json
*   netmonitor/electron/main.js
*   netmonitor/src/index.html

### Completion Notes
*   Successfully generated Android platform using `@capacitor/android`.
*   Verified `AndroidManifest.xml` contains INTERNET permission.
*   Verified `electron/main.js` points to correct `www` path.
*   Verified Safe Area meta tags in `index.html`.
*   Dependencies for Electron and Capacitor are correctly configured.

### Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-12-04 | 1.0 | Initial draft for Story 1.4 | Bob (Scrum Master) |
| 2025-12-04 | 1.1 | Refined ACs for verifiability and Approved | Sarah (PO) |
| 2025-12-04 | 1.2 | Implemented story, generated android, verified electron | James (Dev) |

## QA Results
### Analysis
- **Verification Method:** Static analysis of configuration files and build scripts.
- **Android:** `AndroidManifest.xml` verified for INTERNET permission. Directory structure is correct.
- **Electron:** `main.js` entry point and `package.json` scripts verified.
- **UX/UI:** Safe area meta tags confirmed in `index.html`.

### Risk Assessment
- **Rating:** Low Risk / High Impact
- **Rationale:** Configuration is standard, minimizing likelihood of failure, but correct configuration is critical for platform launch.

### Gate Decision
**PASS** - All verifiable artifacts are present and correct.
